# ------------------------------
# Airflow Core Image Settings
# ------------------------------
images:
  airflow:
    repository: dwnusa/airflow
    tag: v3.0.2-jdk17-pyspark-3.5.5-amd64
    pullPolicy: IfNotPresent
# images:
#   airflow:
#     repository: apache/airflow
#     tag: 3.0.2
#     pullPolicy: Always

# airflow:
#   extraPipPackages:
#     - apache-airflow-providers-apache-spark
#     - apache-airflow-providers-cncf-kubernetes
# ------------------------------
# PostgreSQL (내장 DB) 설정
# ------------------------------
postgresql:
  enabled: true
  image:
    tag: latest         # 최신 PostgreSQL 사용
  persistence:
    enabled: false      # 로컬 테스트 환경에서는 굳이 PV/PVC 안 씀

# ------------------------------
# DAGs Volume Mounts
# ------------------------------
dags:
  persistence:
    # enabled: false
    enabled: true
    existingClaim: airflow-dags  # ✅ PVC 이름 지정
  gitSync:
    enabled: false      # Git Sync 기능 비활성화

# extraVolumes:  # 최상위 레벨에 있어야 함
#   - name: spark-yaml-volume
#     hostPath:
#       path: /opt/kafka-on-k3d/spark/yaml
#       type: DirectoryOrCreate
# 
# extraVolumeMounts:
#   - name: spark-yaml-volume
#     mountPath: /opt/airflow/spark-yaml
#     readOnly: false
# ------------------------------
# Webserver NodePort 설정
# ------------------------------
# webserver:
#   service:
#     type: NodePort
#     ports:
#       - name: airflow-ui
#         port: 8080
#         nodePort: 30097

# ⚠️ Airflow 3.0에서는 webserver → api-server 로 이름 변경됨
# webserver:
#   service:
#     type: NodePort
#     ports:
#       - name: airflow-ui
#         port: 8080
#         nodePort: 30097
# ------------------------------
# 기타 (Scheduler, Triggerer 등 기본값 유지)
# ------------------------------
scheduler:
  replicas: 1
  extraVolumes:
    - name: spark-yaml-volume
      hostPath:
        path: /opt/kafka-on-k3d/spark/yaml
        type: DirectoryOrCreate
  extraVolumeMounts:
    - name: spark-yaml-volume
      mountPath: /opt/spark-yaml
      readOnly: false


triggerer:
  replicas: 1
  extraVolumes:
    - name: spark-yaml-volume
      hostPath:
        path: /opt/kafka-on-k3d/spark/yaml
        type: DirectoryOrCreate
  extraVolumeMounts:
    - name: spark-yaml-volume
      mountPath: /opt/spark-yaml
      readOnly: false


workers:
  replicas: 1
  extraVolumes:
    - name: spark-yaml-volume
      hostPath:
        path: /opt/kafka-on-k3d/spark/yaml
        type: DirectoryOrCreate
  extraVolumeMounts:
    - name: spark-yaml-volume
      mountPath: /opt/spark-yaml
      readOnly: false

# ------------------------------
# (선택) 이미지 캐시 무시하고 항상 새로 pull 하려면 아래 활성화
# ------------------------------
# images:
#   airflow:
#     repository: apache/airflow
#     tag: 3.0.2
#     pullPolicy: Always


# images:
#   airflow:
#     repository: apache/airflow
#     tag: 2.8.1-python3.9
#     pullPolicy: IfNotPresent

# # images:
# #   airflow:
# #     repository: dwnusa/airflow
# #     tag: v2.8.1-jdk17-pyspark-3.5.5-amd64
# #     pullPolicy: IfNotPresent

  
# dags:
#   persistence:
#     enabled: false

# postgresql:
#   enabled: true
#   image:
#     tag: latest



# extraVolumes:
#   - name: spark-yaml-volume
#     hostPath:
#       path: /opt/kafka-on-k3d/spark/yaml
#       type: Directory # DirectoryOrCreate
# 
# extraVolumeMounts:
#   - name: spark-yaml-volume
#     mountPath: /opt/spark-yaml
#     # readOnly: false


  # Already installed in Dockerfile 
  # extraPipPackages:
  #   - apache-airflow-providers-apache-spark
  #   - apache-airflow-providers-cncf-kubernetes

# web:
#   service:
#     type: NodePort
#     ports:
#       - name: airflow-ui
#         port: 8080
#         nodePort: 30097
